---
title: ã€ç»ƒä¹ ã€‘å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°åŠç»å…¸ä¹ é¢˜
typora-root-url: ã€ç»ƒä¹ ã€‘å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°åŠç»å…¸ä¹ é¢˜
mathjax: true
date: 2025-06-14 13:20:25
tags:
    - å®è·µ
    - LeetCode
categories: 
  - ç»å…¸é˜Ÿåˆ—/æ ˆç®—æ³•
  - ç®—æ³•
  - æ•°æ®ç»“æ„
---

# ã€ç»ƒä¹ ã€‘å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°åŠç»å…¸ä¹ é¢˜

## [é€šç”¨å®ç°](https://labuladong.online/algo/problem-set/monotonic-queue/#é€šç”¨å®ç°)

æˆ‘å…ˆæä¾›ä¸€ä¸ªå•è°ƒé˜Ÿåˆ—ç»“æ„çš„é€šç”¨å®ç°ï¼Œè¿™é‡Œæ¶‰åŠ Java çš„æ³›å‹ï¼Œ`E` å°±ä»£è¡¨ä»»æ„ç±»å‹ï¼Œ`E extends Comparable<E>` çš„æ„æ€æ˜¯è¿™ä¸ªç±»å‹ `E` éœ€è¦å®ç° `Comparable` æ¥å£ï¼Œå³ç±»å‹ `E` æ˜¯å¯æ¯”è¾ƒçš„ï¼Œæ¯”å¦‚ `Integer, String` è¿™ç§å®ç°äº† `compareTo` æ–¹æ³•çš„ç±»å‹ã€‚åŸå› ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå› ä¸ºä½ è¦æ±‚é˜Ÿåˆ—ä¸­å…ƒç´ çš„æœ€å€¼å˜›ï¼Œæ‰€ä»¥å…ƒç´ å½“ç„¶å¾—æ˜¯æœ‰å¤§å°ä¹‹åˆ†ï¼ˆå¯æ¯”è¾ƒï¼‰çš„ã€‚

æˆ‘ä»¬åŸå…ˆçš„ç®€é™‹å®ç°åŒ…å«äº† `max` æ–¹æ³•çš„å®ç°ï¼Œå…¶åŸç†æ˜¯åœ¨åº•å±‚ç»´æŠ¤äº†ä¸€ä¸ªé˜Ÿåˆ— `maxq`ï¼Œç»´æŠ¤è¿™ä¸ªé˜Ÿåˆ—ä¸­ä»å°¾éƒ¨åˆ°å¤´éƒ¨çš„å…ƒç´ å•è°ƒé€’å¢ã€‚

é‚£ä¹ˆå®ç° `min` æ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå¯ä»¥**åœ¨åº•å±‚å†ç»´æŠ¤ä¸€ä¸ª `minq` é˜Ÿåˆ—**ï¼Œç»´æŠ¤é˜Ÿåˆ—ä¸­å…ƒç´ ä»å°¾éƒ¨åˆ°å¤´éƒ¨çš„å…ƒç´ å•è°ƒé€’å‡ï¼Œè¿™æ ·å¤´éƒ¨ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯æ‰€æœ‰å…ƒç´ ä¸­çš„æœ€å°å€¼äº†ã€‚

å½“ç„¶ï¼Œç”±äº `push` æ–¹æ³•åœ¨æ·»åŠ å…ƒç´ çš„åŒæ—¶è¿˜å¯èƒ½ä¼šåˆ é™¤å…ƒç´ ï¼Œæ‰€ä»¥ `maxq` å’Œ `minq` ä¸­éƒ½æ²¡æœ‰ä¿å­˜æ‰€æœ‰å…ƒç´ ã€‚å¦‚æœæƒ³å®ç°æ ‡å‡†çš„ `pop` æ–¹æ³•ä»¥åŠ `size` æ–¹æ³•ï¼Œ**æˆ‘ä»¬è¿˜å¾—å†é¢å¤–ç»´æŠ¤ä¸€ä¸ªæ ‡å‡†é˜Ÿåˆ— `q`**ï¼Œè¿™ä¸ª `q` å­˜å‚¨æ‰€æœ‰å­˜åœ¨äºé˜Ÿåˆ—ä¸­çš„å…ƒç´ ï¼Œä¸ç»´æŠ¤å•è°ƒæ€§ã€‚

ç»¼ä¸Šï¼Œå¯ä»¥å¾—åˆ° `MonotonicQueue` çš„é€šç”¨å®ç°ï¼Œå…·ä½“é€»è¾‘çœ‹æ³¨é‡Šï¼š



```python
from collections import deque
from typing import TypeVar, Generic

E = TypeVar('E')

# å•è°ƒé˜Ÿåˆ—çš„å®ç°ï¼Œå¯ä»¥é«˜æ•ˆç»´æŠ¤æœ€å¤§å€¼å’Œæœ€å°å€¼
class MonotonicQueue(Generic[E]):
    def __init__(self):
        # å¸¸è§„é˜Ÿåˆ—ï¼Œå­˜å‚¨æ‰€æœ‰å…ƒç´ 
        self.q = deque()
        # å…ƒç´ é™åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å¤§å€¼
        self.maxq = deque()
        # å…ƒç´ å‡åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å°å€¼
        self.minq = deque()

    def push(self, elem: E):
        # ç»´æŠ¤å¸¸è§„é˜Ÿåˆ—ï¼Œç›´æ¥åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ 
        self.q.append(elem)

        # ç»´æŠ¤ maxqï¼Œå°†å°äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.maxq and self.maxq[-1] < elem:
            self.maxq.pop()
        self.maxq.append(elem)

        # ç»´æŠ¤ minqï¼Œå°†å¤§äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.minq and self.minq[-1] > elem:
            self.minq.pop()
        self.minq.append(elem)

    def max(self) -> E:
        # maxq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.maxq[0]

    def min(self) -> E:
        # minq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.minq[0]

    def pop(self) -> E:
        # ä»æ ‡å‡†é˜Ÿåˆ—å¤´éƒ¨å¼¹å‡ºéœ€è¦åˆ é™¤çš„å…ƒç´ 
        deleteVal = self.q.popleft()
        assert deleteVal is not None

        # ç”±äº push çš„æ—¶å€™ä¼šåˆ é™¤å…ƒç´ ï¼ŒdeleteVal å¯èƒ½å·²ç»è¢«åˆ æ‰äº†
        if deleteVal == self.maxq[0]:
            self.maxq.popleft()
        if deleteVal == self.minq[0]:
            self.minq.popleft()
        return deleteVal

    def size(self) -> int:
        # æ ‡å‡†é˜Ÿåˆ—çš„å¤§å°å³æ˜¯å½“å‰é˜Ÿåˆ—çš„å¤§å°
        return len(self.q)

    def isEmpty(self) -> bool:
        return not self.q
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªé€šç”¨å®ç°å†…éƒ¨ç»´æŠ¤äº†ä¸‰ä¸ªé˜Ÿåˆ—ï¼Œä¸”æ¶‰åŠåˆ° Java çš„æ³›å‹ï¼Œæ‰€ä»¥åœ¨åˆ·é¢˜å¹³å°ä¸Šæ‰§è¡Œçš„æ•ˆç‡ä¸ä¼šé«˜ï¼Œå¦‚æœä½ è¿½æ±‚æ•ˆç‡çš„è¯ï¼Œå¯ä»¥æ ¹æ®å…·ä½“çš„é¢˜ç›®ç®€åŒ–å•è°ƒé˜Ÿåˆ—çš„å®ç°ï¼Œä»è€Œæå‡æ•ˆç‡ã€‚ä¸‹é¢çœ‹å‡ é“å•è°ƒé˜Ÿåˆ—çš„ç»å…¸åº”ç”¨ã€‚

## [å•è°ƒé˜Ÿåˆ— + æ»‘åŠ¨çª—å£](https://labuladong.online/algo/problem-set/monotonic-queue/#å•è°ƒé˜Ÿåˆ—-æ»‘åŠ¨çª—å£)

å•è°ƒé˜Ÿåˆ—å¯ä»¥å’Œ [æ»‘åŠ¨çª—å£](https://labuladong.online/algo/essential-technique/sliding-window-framework/) ç®—æ³•ç»“åˆï¼Œåœ¨çª—å£æ»‘åŠ¨çš„è¿‡ç¨‹ä¸­å¿«é€Ÿè®¡ç®—çª—å£å†…éƒ¨çš„æœ€å€¼ã€‚

------

## [1438. ç»å¯¹å·®ä¸è¶…è¿‡é™åˆ¶çš„æœ€é•¿è¿ç»­å­æ•°ç»„](https://labuladong.online/algo/problem-set/monotonic-queue/#slug_longest-continuous-subarray-with-absolute-diff-less-than-or-equal-to-limit)

<details class="hint-container details" open="" style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.1); transition: background 0.3s ease 0s, color 0.3s ease 0s; display: block; margin-block: 0.75rem; padding: 1.25rem 1rem; border-radius: 0.5rem; color: rgb(60, 60, 67); font-family: Inter, ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="position: relative; margin: -1rem -1rem 0.5em; padding-block: 1em; padding-inline: 3em 1.5em; list-style: none; font-size: 16px; cursor: pointer;"><strong style="font-weight: 600;">1438. ç»å¯¹å·®ä¸è¶…è¿‡é™åˆ¶çš„æœ€é•¿è¿ç»­å­æ•°ç»„</strong>&nbsp;|<span>&nbsp;</span><span><a href="https://leetcode.cn/problems/longest-continuous-subarray-with-absolute-diff-less-than-or-equal-to-limit/" class="" target="_blank" rel="noopener noreferrer" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">åŠ›æ‰£</a><span>&nbsp;</span>|<span>&nbsp;</span></span><span><a href="https://leetcode.com/problems/longest-continuous-subarray-with-absolute-diff-less-than-or-equal-to-limit/" class="" target="_blank" rel="noopener noreferrer" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">LeetCode</a><span>&nbsp;</span>|</span><span>&nbsp;</span>&nbsp;ğŸŸ </summary><div><p style="line-height: 1.6; overflow-wrap: break-word;">ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums</code><span>&nbsp;</span>ï¼Œå’Œä¸€ä¸ªè¡¨ç¤ºé™åˆ¶çš„æ•´æ•°<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">limit</code>ï¼Œè¯·ä½ è¿”å›æœ€é•¿è¿ç»­å­æ•°ç»„çš„é•¿åº¦ï¼Œè¯¥å­æ•°ç»„ä¸­çš„ä»»æ„ä¸¤ä¸ªå…ƒç´ ä¹‹é—´çš„ç»å¯¹å·®å¿…é¡»å°äºæˆ–è€…ç­‰äº<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">limit</code><em><span>&nbsp;</span>ã€‚</em></p><p style="line-height: 1.6; overflow-wrap: break-word;">å¦‚æœä¸å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„ï¼Œåˆ™è¿”å›<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">0</code><span>&nbsp;</span>ã€‚</p><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 1ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [8,2,4,7], limit = 4
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>2 
<strong style="font-weight: 600;">è§£é‡Šï¼š</strong>æ‰€æœ‰å­æ•°ç»„å¦‚ä¸‹ï¼š
[8] æœ€å¤§ç»å¯¹å·® |8-8| = 0 &lt;= 4.
[8,2] æœ€å¤§ç»å¯¹å·® |8-2| = 6 &gt; 4. 
[8,2,4] æœ€å¤§ç»å¯¹å·® |8-2| = 6 &gt; 4.
[8,2,4,7] æœ€å¤§ç»å¯¹å·® |8-2| = 6 &gt; 4.
[2] æœ€å¤§ç»å¯¹å·® |2-2| = 0 &lt;= 4.
[2,4] æœ€å¤§ç»å¯¹å·® |2-4| = 2 &lt;= 4.
[2,4,7] æœ€å¤§ç»å¯¹å·® |2-7| = 5 &gt; 4.
[4] æœ€å¤§ç»å¯¹å·® |4-4| = 0 &lt;= 4.
[4,7] æœ€å¤§ç»å¯¹å·® |4-7| = 3 &lt;= 4.
[7] æœ€å¤§ç»å¯¹å·® |7-7| = 0 &lt;= 4. 
å› æ­¤ï¼Œæ»¡è¶³é¢˜æ„çš„æœ€é•¿å­æ•°ç»„çš„é•¿åº¦ä¸º 2 ã€‚
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 2ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [10,1,2,4,7,2], limit = 5
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>4 
<strong style="font-weight: 600;">è§£é‡Šï¼š</strong>æ»¡è¶³é¢˜æ„çš„æœ€é•¿å­æ•°ç»„æ˜¯ [2,4,7,2]ï¼Œå…¶æœ€å¤§ç»å¯¹å·® |2-7| = 5 &lt;= 5 ã€‚
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 3ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [4,2,2,2,4,4,2,2], limit = 0
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>3
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">æç¤ºï¼š</strong></p><ul style="line-height: 1.6; overflow-wrap: break-word; padding-inline-start: 1.2em;"><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">1 &lt;= nums.length &lt;= 10^5</code></li><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">1 &lt;= nums[i] &lt;= 10^9</code></li><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">0 &lt;= limit &lt;= 10^9</code></li></ul></div><strong style="font-weight: 600; font-size: small;">é¢˜ç›®æ¥æºï¼š<a href="https://leetcode.cn/problems/longest-continuous-subarray-with-absolute-diff-less-than-or-equal-to-limit/" class="" target="_blank" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">åŠ›æ‰£ 1438. ç»å¯¹å·®ä¸è¶…è¿‡é™åˆ¶çš„æœ€é•¿è¿ç»­å­æ•°ç»„</a>ã€‚</strong></details>

### [åŸºæœ¬æ€è·¯](https://labuladong.online/algo/problem-set/monotonic-queue/#åŸºæœ¬æ€è·¯)

å¾ˆæ˜æ˜¾è¿™é“é¢˜éœ€è¦ç”¨åˆ°å‰æ–‡è®²çš„ [æ»‘åŠ¨çª—å£æŠ€å·§æ ¸å¿ƒæ¡†æ¶è¯¦è§£](https://labuladong.online/algo/essential-technique/sliding-window-framework/)ï¼š

å½“çª—å£å†…ç»å¯¹å€¼ä¹‹å·®ä¸è¶…è¿‡ `limit` æ—¶æ‰©å¤§çª—å£ï¼Œå½“æ–°åŠ å…¥çª—å£çš„å…ƒç´ ä½¿å¾—ç»å¯¹å€¼ä¹‹å·®è¶…è¿‡ `limit` æ—¶å¼€å§‹æ”¶ç¼©çª—å£ï¼Œçª—å£çš„æœ€å¤§å®½åº¦å³æœ€é•¿å­æ•°ç»„çš„é•¿åº¦ã€‚

ä½†æœ‰ä¸ªé—®é¢˜ï¼Œå½“çª—å£è¿›æ–°å…ƒç´ æ—¶ï¼Œæˆ‘å¯ä»¥æ›´æ–°çª—å£ä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œä½†å½“çª—å£æ”¶ç¼©æ—¶ï¼Œå¦‚ä½•æ›´æ–°æœ€å¤§å€¼å’Œæœ€å°å€¼å‘¢ï¼Ÿéš¾é“è¦éå†ä¸€éçª—å£ä¸­çš„æ‰€æœ‰å…ƒç´ å—ï¼Ÿè¿™å°±ç”¨åˆ°å•è°ƒé˜Ÿåˆ—ç»“æ„äº†ï¼Œè¿™é‡Œéœ€è¦ä¸€ä¸ªé€šç”¨çš„ `MonotonicQueue` ç±»ï¼Œç”¨æ¥é«˜æ•ˆåˆ¤æ–­çª—å£ä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚

> PSï¼š`MonotonicQueue` çš„é€šç”¨å®ç°è§ [å•è°ƒé˜Ÿåˆ—è®¾è®¡ä¸å®ç°](https://labuladong.online/algo/problem-set/monotonic-queue/)

**è¯¦ç»†é¢˜è§£**ï¼š

- [ã€ç»ƒä¹ ã€‘å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°åŠç»å…¸ä¹ é¢˜](https://labuladong.online/algo/problem-set/monotonic-queue/)

### [è§£æ³•ä»£ç ](https://labuladong.online/algo/problem-set/monotonic-queue/#è§£æ³•ä»£ç )



```python
class Solution:
    def longestSubarray(self, nums: List[int], limit: int) -> int:
        left = 0
        right = 0
        windowSize = 0
        res = 0
        window = MonotonicQueue()
        # æ»‘åŠ¨çª—å£æ¨¡æ¿
        while right < len(nums):
            # æ‰©å¤§çª—å£ï¼Œæ›´æ–°çª—å£æœ€å€¼
            window.push(nums[right])
            right += 1
            windowSize += 1
            while window.max() - window.min() > limit:
                # ç¼©å°çª—å£ï¼Œæ›´æ–°çª—å£æœ€å€¼
                window.pop()
                left += 1
                windowSize -= 1
            # åœ¨çª—å£æ”¶ç¼©åˆ¤æ–­å®Œä¹‹åæ‰æ›´æ–°ç­”æ¡ˆ
            res = max(res, windowSize)
        return res

# ä¸‹é¢ç»™å‡ºçš„æ˜¯å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°ï¼Œè¿è¡Œé€Ÿåº¦å¯èƒ½è¾ƒæ…¢ï¼Œä½ å¯ä»¥è‡ªè¡Œç®€åŒ–æå‡é€Ÿåº¦
# å•è°ƒé˜Ÿåˆ—çš„è¯¦ç»†è§£æè§
# https://labuladong.online/algo/problem-set/monotonic-queue/
class MonotonicQueue:
    def __init__(self):
        # å¸¸è§„é˜Ÿåˆ—ï¼Œå­˜å‚¨æ‰€æœ‰å…ƒç´ 
        self.q = collections.deque()
        # å…ƒç´ é™åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å¤§å€¼
        self.maxq = collections.deque()
        # å…ƒç´ å‡åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å°å€¼
        self.minq = collections.deque()

    def push(self, elem: int):
        # ç»´æŠ¤å¸¸è§„é˜Ÿåˆ—ï¼Œç›´æ¥åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ 
        self.q.append(elem)

        # ç»´æŠ¤ maxqï¼Œå°†å°äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.maxq and self.maxq[-1] < elem:
            self.maxq.pop()
        self.maxq.append(elem)

        # ç»´æŠ¤ minqï¼Œå°†å¤§äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.minq and self.minq[-1] > elem:
            self.minq.pop()
        self.minq.append(elem)

    def max(self) -> int:
        # maxq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.maxq[0]

    def min(self) -> int:
        # minq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.minq[0]

    def pop(self) -> int:
        # ä»æ ‡å‡†é˜Ÿåˆ—å¤´éƒ¨å¼¹å‡ºéœ€è¦åˆ é™¤çš„å…ƒç´ 
        deleteVal = self.q.popleft()

        # ç”±äº push çš„æ—¶å€™ä¼šåˆ é™¤å…ƒç´ ï¼ŒdeleteVal å¯èƒ½å·²ç»è¢«åˆ æ‰äº†
        if deleteVal == self.maxq[0]:
            self.maxq.popleft()
        if deleteVal == self.minq[0]:
            self.minq.popleft()
        return deleteVal

    def size(self) -> int:
        # æ ‡å‡†é˜Ÿåˆ—çš„å¤§å°å³æ˜¯å½“å‰é˜Ÿåˆ—çš„å¤§å°
        return len(self.q)

    def isEmpty(self) -> bool:
        return not self.q
```

### [å¯è§†åŒ–](https://labuladong.online/algo/problem-set/monotonic-queue/#å¯è§†åŒ–)

<details data-v-ee1a9bd0="" id="div_longest-continuous-subarray-with-absolute-diff-less-than-or-equal-to-limit" class="hint-container details" style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.1); transition: background 0.3s ease 0s, color 0.3s ease 0s; display: block; margin-block: 0.75rem; padding: 1rem 0px 0px; border-radius: 0.5rem; margin: 1.3em 0px;"><summary data-v-ee1a9bd0="" style="position: relative; margin: -1rem 0px 0px; padding-block: 1em; padding-inline: 2.3em 1.5em; list-style: none; font-size: large; cursor: pointer; display: flex; align-items: center;"><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path data-v-ee1a9bd0="" fill="currentColor" d="m4.415 18.167l7.17-7.17l1.414 1.414l-7.17 7.17z" opacity="0.3"></path><path data-v-ee1a9bd0="" fill="currentColor" d="m20 7l.94-2.06L23 4l-2.06-.94L20 1l-.94 2.06L17 4l2.06.94zM8.5 7l.94-2.06L11.5 4l-2.06-.94L8.5 1l-.94 2.06L5.5 4l2.06.94zM20 12.5l-.94 2.06l-2.06.94l2.06.94l.94 2.06l.94-2.06L23 15.5l-2.06-.94zm-2.29-3.38l-2.83-2.83c-.2-.19-.45-.29-.71-.29s-.51.1-.71.29L2.29 17.46a.996.996 0 0 0 0 1.41l2.83 2.83c.2.2.45.3.71.3s.51-.1.71-.29l11.17-11.17c.39-.39.39-1.03 0-1.42M5.83 19.59l-1.41-1.41L11.59 11L13 12.41zM14.41 11L13 9.59l1.17-1.17l1.41 1.41z"></path></svg>&nbsp;<strong data-v-ee1a9bd0="" style="font-weight: 600;">ç®—æ³•å¯è§†åŒ–é¢æ¿</strong><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="0.9em" height="0.9em" viewBox="0 0 24 24" style="margin-left: auto; margin-right: 10px;"><path data-v-ee1a9bd0="" fill="currentColor" d="M20 20v1h1v-1zm-4.293-5.707a1 1 0 0 0-1.414 1.414zM19 14v6h2v-6zm1 5h-6v2h6zm.707.293l-5-5l-1.414 1.414l5 5zM4 20H3v1h1zm5.707-4.293a1 1 0 0 0-1.414-1.414zM3 14v6h2v-6zm1 7h6v-2H4zm.707-.293l5-5l-1.414-1.414l-5 5zM20 4h1V3h-1zm-5.707 4.293a1 1 0 0 0 1.414 1.414zM21 10V4h-2v6zm-1-7h-6v2h6zm-.707.293l-5 5l1.414 1.414l5-5zM4 4V3H3v1zm4.293 5.707a1 1 0 0 0 1.414-1.414zM5 10V4H3v6zM4 5h6V3H4zm-.707-.293l5 5l1.414-1.414l-5-5z"></path></svg><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" style="margin-right: 10px;"><path data-v-ee1a9bd0="" fill="currentColor" d="M17.65 6.35a7.95 7.95 0 0 0-6.48-2.31c-3.67.37-6.69 3.35-7.1 7.02C3.52 15.91 7.27 20 12 20a7.98 7.98 0 0 0 7.21-4.56c.32-.67-.16-1.44-.9-1.44c-.37 0-.72.2-.88.53a5.994 5.994 0 0 1-6.8 3.31c-2.22-.49-4.01-2.3-4.48-4.52A6.002 6.002 0 0 1 12 6c1.66 0 3.14.69 4.22 1.78l-1.51 1.51c-.63.63-.19 1.71.7 1.71H19c.55 0 1-.45 1-1V6.41c0-.89-1.08-1.34-1.71-.71z"></path></svg><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path data-v-ee1a9bd0="" fill="currentColor" d="M17 7h-4v2h4c1.65 0 3 1.35 3 3s-1.35 3-3 3h-4v2h4c2.76 0 5-2.24 5-5s-2.24-5-5-5m-6 8H7c-1.65 0-3-1.35-3-3s1.35-3 3-3h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4zm-3-4h8v2H8z"></path></svg></summary><div data-v-ee1a9bd0="" class="resizable" style="width: 780px; max-width: 100%; height: 70vh; min-height: 500px; overflow: hidden; resize: both;"><iframe data-v-ee1a9bd0="" title="algo-visualize panel" allow="clipboard-write; fullscreen;" id="iframe_longest-continuous-subarray-with-absolute-diff-less-than-or-equal-to-limit" src="https://labuladong.online/algo-visualize/leetcode/longest-continuous-subarray-with-absolute-diff-less-than-or-equal-to-limit/" width="100%" height="100%" loading="lazy" scrolling="auto" frameborder="0" style="overflow: auto;"></iframe></div></details>

## [862. å’Œè‡³å°‘ä¸º K çš„æœ€çŸ­å­æ•°ç»„](https://labuladong.online/algo/problem-set/monotonic-queue/#slug_shortest-subarray-with-sum-at-least-k)

<details class="hint-container details" open="" style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.1); transition: background 0.3s ease 0s, color 0.3s ease 0s; display: block; margin-block: 0.75rem; padding: 1.25rem 1rem; border-radius: 0.5rem; color: rgb(60, 60, 67); font-family: Inter, ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="position: relative; margin: -1rem -1rem 0.5em; padding-block: 1em; padding-inline: 3em 1.5em; list-style: none; font-size: 16px; cursor: pointer;"><strong style="font-weight: 600;">862. å’Œè‡³å°‘ä¸º K çš„æœ€çŸ­å­æ•°ç»„</strong>&nbsp;|<span>&nbsp;</span><span><a href="https://leetcode.cn/problems/shortest-subarray-with-sum-at-least-k/" class="" target="_blank" rel="noopener noreferrer" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">åŠ›æ‰£</a><span>&nbsp;</span>|<span>&nbsp;</span></span><span><a href="https://leetcode.com/problems/shortest-subarray-with-sum-at-least-k/" class="" target="_blank" rel="noopener noreferrer" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">LeetCode</a><span>&nbsp;</span>|</span><span>&nbsp;</span>&nbsp;ğŸ”´</summary><div><p style="line-height: 1.6; overflow-wrap: break-word;">ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums</code><span>&nbsp;</span>å’Œä¸€ä¸ªæ•´æ•°<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">k</code><span>&nbsp;</span>ï¼Œæ‰¾å‡º<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums</code><span>&nbsp;</span>ä¸­å’Œè‡³å°‘ä¸º<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">k</code><span>&nbsp;</span>çš„<span>&nbsp;</span><strong style="font-weight: 600;">æœ€çŸ­éç©ºå­æ•°ç»„</strong><span>&nbsp;</span>ï¼Œå¹¶è¿”å›è¯¥å­æ•°ç»„çš„é•¿åº¦ã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„<span>&nbsp;</span><strong style="font-weight: 600;">å­æ•°ç»„</strong><span>&nbsp;</span>ï¼Œè¿”å›<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">-1</code><span>&nbsp;</span>ã€‚</p><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">å­æ•°ç»„</strong><span>&nbsp;</span>æ˜¯æ•°ç»„ä¸­<span>&nbsp;</span><strong style="font-weight: 600;">è¿ç»­</strong><span>&nbsp;</span>çš„ä¸€éƒ¨åˆ†ã€‚</p><ol style="line-height: 1.6; overflow-wrap: break-word; padding-inline-start: 1.2em;"></ol><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 1ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [1], k = 1
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>1
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 2ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [1,2], k = 4
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>-1
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 3ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [2,-1,2], k = 3
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>3
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">æç¤ºï¼š</strong></p><ul style="line-height: 1.6; overflow-wrap: break-word; padding-inline-start: 1.2em;"><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">1 &lt;= nums.length &lt;= 10<sup>5</sup></code></li><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">-10<sup>5</sup><span>&nbsp;</span>&lt;= nums[i] &lt;= 10<sup>5</sup></code></li><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">1 &lt;= k &lt;= 10<sup>9</sup></code></li></ul></div><strong style="font-weight: 600; font-size: small;">é¢˜ç›®æ¥æºï¼š<a href="https://leetcode.cn/problems/shortest-subarray-with-sum-at-least-k/" class="" target="_blank" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">åŠ›æ‰£ 862. å’Œè‡³å°‘ä¸º K çš„æœ€çŸ­å­æ•°ç»„</a>ã€‚</strong></details>

### [åŸºæœ¬æ€è·¯](https://labuladong.online/algo/problem-set/monotonic-queue/#åŸºæœ¬æ€è·¯-1)

è¿™é¢˜çš„éš¾åº¦æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œéš¾ç‚¹åœ¨äºåŒæ—¶ç»“åˆäº† [æ»‘åŠ¨çª—å£ç®—æ³•](https://labuladong.online/algo/essential-technique/sliding-window-framework/)ã€[å‰ç¼€å’ŒæŠ€å·§](https://labuladong.online/algo/data-structure/prefix-sum/) å’Œ [å•è°ƒé˜Ÿåˆ—](https://labuladong.online/algo/data-structure/monotonic-queue/) å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼Œå»ºè®®ä½ å…ˆç†è§£è¿™ä¸‰ç¯‡æ–‡ç« çš„è¦ä¹‰ï¼Œå¦åˆ™çœ‹ä¸æ‡‚è¿™é¢˜çš„è§£æ³•ã€‚

é¦–å…ˆï¼Œæƒ³è¦å¿«é€Ÿè®°å½•å­æ•°ç»„çš„å’Œï¼Œéœ€è¦ [å‰ç¼€å’ŒæŠ€å·§](https://labuladong.online/algo/data-structure/prefix-sum/) é¢„è®¡ç®—ä¸€ä¸ª `preSum` æ•°ç»„ï¼Œç„¶ååœ¨è¿™ä¸ª `preSum` æ•°ç»„ä¸Šæ–½å±• [æ»‘åŠ¨çª—å£ç®—æ³•](https://labuladong.online/algo/essential-technique/sliding-window-framework/) å¯»æ‰¾ä¸€ä¸ªå·®å€¼å¤§äºç­‰äº `k` ä¸”å®½åº¦æœ€å°çš„ã€Œçª—å£ã€ï¼Œè¿™ä¸ªçª—å£çš„å¤§å°å°±æ˜¯é¢˜ç›®æƒ³è¦çš„ç»“æœã€‚

è¿™é‡Œé¢è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå½“æ»‘åŠ¨çª—å£æ‰©å¤§æ—¶ï¼Œæ–°è¿›å…¥çª—å£çš„å…ƒç´  `preSum[right]` éœ€è¦çŸ¥é“çª—å£ä¸­æœ€å°çš„é‚£ä¸ªå…ƒç´ æ˜¯å¤šå°‘ï¼Œå’Œæœ€å°çš„é‚£ä¸ªå…ƒç´ ç›¸å‡æ‰èƒ½å¾—åˆ°å°½å¯èƒ½å¤§çš„å­æ•°ç»„å’Œã€‚

å¦‚ä½•å¿«é€Ÿåˆ¤æ–­çª—å£ä¸­çš„æœ€å€¼ï¼Ÿè¿™å°±éœ€è¦å•è°ƒé˜Ÿåˆ—ç»“æ„å‡ºé©¬äº†ï¼Œç›´æ¥çœ‹è§£æ³•ä»£ç å§ã€‚

> PSï¼š`MonotonicQueue` çš„é€šç”¨å®ç°è§ [å•è°ƒé˜Ÿåˆ—è®¾è®¡ä¸å®ç°](https://labuladong.online/algo/problem-set/monotonic-queue/)

**è¯¦ç»†é¢˜è§£**ï¼š

- [ã€ç»ƒä¹ ã€‘å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°åŠç»å…¸ä¹ é¢˜](https://labuladong.online/algo/problem-set/monotonic-queue/)

### [è§£æ³•ä»£ç ](https://labuladong.online/algo/problem-set/monotonic-queue/#è§£æ³•ä»£ç -1)



```python
class Solution:
    def shortestSubarray(self, nums: List[int], k: int) -> int:
        n = len(nums)
        # çœ‹é¢˜ç›®çš„æ•°æ®èŒƒå›´ï¼Œå‰ç¼€å’Œæ•°ç»„ä¸­å…ƒç´ å¯èƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥ç”¨ long ç±»å‹
        preSum = [0] * (n + 1)
        preSum[0] = 0
        # è®¡ç®— nums çš„å‰ç¼€å’Œæ•°ç»„
        for i in range(1, n + 1):
            preSum[i] = preSum[i - 1] + nums[i - 1]
        # å•è°ƒé˜Ÿåˆ—ç»“æ„è¾…åŠ©æ»‘åŠ¨çª—å£ç®—æ³•
        window = MonotonicQueue()
        right = 0
        left = 0
        length = float('inf')
        # å¼€å§‹æ‰§è¡Œæ»‘åŠ¨çª—å£ç®—æ³•æ¡†æ¶
        while right < len(preSum):
            # æ‰©å¤§çª—å£ï¼Œå…ƒç´ å…¥é˜Ÿ
            window.push(preSum[right])
            right += 1
            # è‹¥æ–°è¿›å…¥çª—å£çš„å…ƒç´ å’Œçª—å£ä¸­çš„æœ€å°å€¼ä¹‹å·®å¤§äºç­‰äº kï¼Œ
            # è¯´æ˜å¾—åˆ°äº†ç¬¦åˆæ¡ä»¶çš„å­æ•°ç»„ï¼Œç¼©å°çª—å£ï¼Œä½¿å­æ•°ç»„é•¿åº¦å°½å¯èƒ½å°
            while right < len(preSum) and not window.isEmpty() and preSum[right] - window.min() >= k:
                # æ›´æ–°ç­”æ¡ˆ
                length = min(length, right - left)
                # ç¼©å°çª—å£
                window.pop()
                left += 1
        return -1 if length == float('inf') else length

# ä¸‹é¢ç»™å‡ºçš„æ˜¯å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°ï¼Œè¿è¡Œé€Ÿåº¦å¯èƒ½è¾ƒæ…¢ï¼Œä½ å¯ä»¥è‡ªè¡Œç®€åŒ–æå‡é€Ÿåº¦
# å•è°ƒé˜Ÿåˆ—çš„è¯¦ç»†è§£æè§
# https://labuladong.online/algo/problem-set/monotonic-queue/
class MonotonicQueue:
    def __init__(self):
        # å¸¸è§„é˜Ÿåˆ—ï¼Œå­˜å‚¨æ‰€æœ‰å…ƒç´ 
        self.q = collections.deque()
        # å…ƒç´ é™åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å¤§å€¼
        self.maxq = collections.deque()
        # å…ƒç´ å‡åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å°å€¼
        self.minq = collections.deque()

    def push(self, elem):
        # ç»´æŠ¤å¸¸è§„é˜Ÿåˆ—ï¼Œç›´æ¥åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ 
        self.q.append(elem)

        # ç»´æŠ¤ maxqï¼Œå°†å°äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.maxq and self.maxq[-1] < elem:
            self.maxq.pop()
        self.maxq.append(elem)

        # ç»´æŠ¤ minqï¼Œå°†å¤§äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.minq and self.minq[-1] > elem:
            self.minq.pop()
        self.minq.append(elem)

    def max(self):
        # maxq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.maxq[0]

    def min(self):
        # minq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.minq[0]

    def pop(self):
        # ä»æ ‡å‡†é˜Ÿåˆ—å¤´éƒ¨å¼¹å‡ºéœ€è¦åˆ é™¤çš„å…ƒç´ 
        deleteVal = self.q.popleft()

        # ç”±äº push çš„æ—¶å€™ä¼šåˆ é™¤å…ƒç´ ï¼ŒdeleteVal å¯èƒ½å·²ç»è¢«åˆ æ‰äº†
        if deleteVal == self.maxq[0]:
            self.maxq.popleft()
        if deleteVal == self.minq[0]:
            self.minq.popleft()
        return deleteVal

    def size(self):
        # æ ‡å‡†é˜Ÿåˆ—çš„å¤§å°å³æ˜¯å½“å‰é˜Ÿåˆ—çš„å¤§å°
        return len(self.q)

    def isEmpty(self):
        return not self.q
```

**ç±»ä¼¼é¢˜ç›®**ï¼š

- [209. é•¿åº¦æœ€å°çš„å­æ•°ç»„ ğŸŸ ](https://leetcode.cn/problems/minimum-size-subarray-sum)
- [å‰‘æŒ‡ Offer II 008. å’Œå¤§äºç­‰äº target çš„æœ€çŸ­å­æ•°ç»„ ğŸŸ ](https://leetcode.cn/problems/2VG8Kg)

------

## [å•è°ƒé˜Ÿåˆ— + ç¯å½¢æ•°ç»„](https://labuladong.online/algo/problem-set/monotonic-queue/#å•è°ƒé˜Ÿåˆ—-ç¯å½¢æ•°ç»„)

å•è°ƒé˜Ÿåˆ—è¿˜å¯ä»¥åœ¨ç¯å½¢æ•°ç»„çš„åœºæ™¯ä¸‹æ’ä¸Šç”¨åœºã€‚ä¹‹å‰ [å•è°ƒæ ˆåŸç†](https://labuladong.online/algo/data-structure/monotonic-stack/) ä¸­è®²äº†åªè¦æŠŠæ•°ç»„çš„é•¿åº¦ `n` åŠ å€å°±å¯ä»¥æ¨¡æ‹Ÿç¯å½¢æ•°ç»„ï¼Œä½†å¦‚æœè®©ä½ åœ¨ç¯å½¢æ•°ç»„ä¸­è®¡ç®—å­æ•°ç»„çš„å…ƒç´ å’Œå°±éœ€è¦å•è°ƒé˜Ÿåˆ—è¾…åŠ©äº†ï¼Œå› ä¸ºä½ è¦ä¿è¯å­æ•°ç»„çš„é•¿åº¦ä¸èƒ½è¶…è¿‡ `n`ã€‚

------

## [918. ç¯å½¢å­æ•°ç»„çš„æœ€å¤§å’Œ](https://labuladong.online/algo/problem-set/monotonic-queue/#slug_maximum-sum-circular-subarray)

<details class="hint-container details" open="" style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.1); transition: background 0.3s ease 0s, color 0.3s ease 0s; display: block; margin-block: 0.75rem; padding: 1.25rem 1rem; border-radius: 0.5rem; color: rgb(60, 60, 67); font-family: Inter, ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="position: relative; margin: -1rem -1rem 0.5em; padding-block: 1em; padding-inline: 3em 1.5em; list-style: none; font-size: 16px; cursor: pointer;"><strong style="font-weight: 600;">918. ç¯å½¢å­æ•°ç»„çš„æœ€å¤§å’Œ</strong>&nbsp;|<span>&nbsp;</span><span><a href="https://leetcode.cn/problems/maximum-sum-circular-subarray/" class="" target="_blank" rel="noopener noreferrer" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">åŠ›æ‰£</a><span>&nbsp;</span>|<span>&nbsp;</span></span><span><a href="https://leetcode.com/problems/maximum-sum-circular-subarray/" class="" target="_blank" rel="noopener noreferrer" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">LeetCode</a><span>&nbsp;</span>|</span><span>&nbsp;</span>&nbsp;ğŸŸ </summary><div><p style="line-height: 1.6; overflow-wrap: break-word;">ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">n</code><span>&nbsp;</span>çš„<strong style="font-weight: 600;">ç¯å½¢æ•´æ•°æ•°ç»„</strong>&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums</code>&nbsp;ï¼Œè¿”å›<em>&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums</code>&nbsp;çš„éç©º<span>&nbsp;</span><strong style="font-weight: 600;">å­æ•°ç»„</strong><span>&nbsp;</span>çš„æœ€å¤§å¯èƒ½å’Œ&nbsp;</em>ã€‚</p><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¯å½¢æ•°ç»„</strong><em>&nbsp;</em>æ„å‘³ç€æ•°ç»„çš„æœ«ç«¯å°†ä¼šä¸å¼€å¤´ç›¸è¿å‘ˆç¯çŠ¶ã€‚å½¢å¼ä¸Šï¼Œ<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums[i]</code><span>&nbsp;</span>çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums[(i + 1) % n]</code><span>&nbsp;</span>ï¼Œ<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums[i]</code>&nbsp;çš„å‰ä¸€ä¸ªå…ƒç´ æ˜¯<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums[(i - 1 + n) % n]</code><span>&nbsp;</span>ã€‚</p><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">å­æ•°ç»„</strong><span>&nbsp;</span>æœ€å¤šåªèƒ½åŒ…å«å›ºå®šç¼“å†²åŒº&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums</code>&nbsp;ä¸­çš„æ¯ä¸ªå…ƒç´ ä¸€æ¬¡ã€‚å½¢å¼ä¸Šï¼Œå¯¹äºå­æ•°ç»„&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums[i], nums[i + 1], ..., nums[j]</code>&nbsp;ï¼Œä¸å­˜åœ¨&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">i &lt;= k1, k2 &lt;= j</code>&nbsp;å…¶ä¸­&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">k1 % n == k2 % n</code>&nbsp;ã€‚</p><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 1ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [1,-2,3,-2]
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>3
<strong style="font-weight: 600;">è§£é‡Šï¼š</strong>ä»å­æ•°ç»„ [3] å¾—åˆ°æœ€å¤§å’Œ 3
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 2ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [5,-3,5]
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>10
<strong style="font-weight: 600;">è§£é‡Šï¼š</strong>ä»å­æ•°ç»„ [5,5] å¾—åˆ°æœ€å¤§å’Œ 5 + 5 = 10
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 3ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [3,-2,2,-3]
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>3
<strong style="font-weight: 600;">è§£é‡Šï¼š</strong>ä»å­æ•°ç»„ [3] å’Œ [3,-2,2] éƒ½å¯ä»¥å¾—åˆ°æœ€å¤§å’Œ 3
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">æç¤ºï¼š</strong></p><ul style="line-height: 1.6; overflow-wrap: break-word; padding-inline-start: 1.2em;"><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">n == nums.length</code></li><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">1 &lt;= n &lt;= 3 * 10<sup>4</sup></code></li><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">-3 * 10<sup>4</sup>&nbsp;&lt;= nums[i] &lt;= 3 * 10<sup>4</sup></code></li></ul></div><strong style="font-weight: 600; font-size: small;">é¢˜ç›®æ¥æºï¼š<a href="https://leetcode.cn/problems/maximum-sum-circular-subarray/" class="" target="_blank" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">åŠ›æ‰£ 918. ç¯å½¢å­æ•°ç»„çš„æœ€å¤§å’Œ</a>ã€‚</strong></details>

### [åŸºæœ¬æ€è·¯](https://labuladong.online/algo/problem-set/monotonic-queue/#åŸºæœ¬æ€è·¯-2)

è¯šç„¶ï¼Œè¿™é“é¢˜æœ‰å¾ˆå·§å¦™çš„æ–¹æ³•ï¼Œä½ å¯ä»¥æœç´¢ä¸€ä¸‹ã€ŒKadane ç®—æ³•ã€æ¥è§£å†³è¿™é“é¢˜ã€‚ä¸è¿‡ä¸ºäº†ä¸¾ä¸€åä¸‰åœ°è¿ç”¨æˆ‘ä¹‹å‰è®²è¿‡çš„ç®—æ³•æŠ€å·§ï¼Œæˆ‘å°±ç»“åˆ [å•è°ƒé˜Ÿåˆ—ç»“æ„](https://labuladong.online/algo/data-structure/monotonic-queue/) å’Œå‰æ–‡ [å‰ç¼€å’ŒæŠ€å·§](https://labuladong.online/algo/data-structure/prefix-sum/) å†™ä¸€ä¸ªæ›´é€šç”¨çš„è§£æ³•ã€‚

é¦–å…ˆï¼Œè¿™é“é¢˜å’Œ [53. æœ€å¤§å­åºå’Œ](https://leetcode.cn/problems/maximum-subarray) éå¸¸ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºæœ¬é¢˜çš„æ•°ç»„æ˜¯ç¯å½¢çš„ï¼Œæ‰€ä»¥ä¸Šä¸€é¢˜çš„åŠ¨æ€è§„åˆ’æ€è·¯å’Œå‰ç¼€å’Œæ€è·¯éƒ½ä¸èƒ½ç›´æ¥å¥—ç”¨è¿‡æ¥ã€‚ä¸è¿‡å‰æ–‡ [å•è°ƒæ ˆç»“æ„è¯¦è§£](https://labuladong.online/algo/data-structure/monotonic-stack/) ä¸­è®²è¿‡å¤„ç†ç¯å½¢æ•°ç»„çš„æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯æŠŠåŸæ•°ç»„å¤§å°æ‰©å¤§ä¸€å€ï¼Œè¿™æ ·å°±èƒ½æ¨¡æ‹Ÿå‡ºç¯å½¢çš„æ•ˆæœäº†ã€‚

é‚£ä¹ˆæœ¬é¢˜ä¹Ÿå¯ä»¥æŠŠ `nums` æ•°ç»„æ‰©å¤§ä¸€å€ï¼Œè®¡ç®—å‰ç¼€å’Œæ•°ç»„ `preSum`ï¼Œå€ŸåŠ©ä¸€ä¸ªå®šé•¿ä¸º `nums.length` çš„å•è°ƒé˜Ÿåˆ—æ¥è®¡ç®—ç¯å½¢æ•°ç»„ä¸­çš„æœ€å¤§å­æ•°ç»„å’Œã€‚å…·ä½“å®ç°ç›´æ¥çœ‹ä»£ç å§ã€‚

> PSï¼š`MonotonicQueue` çš„é€šç”¨å®ç°è§ [å•è°ƒé˜Ÿåˆ—è®¾è®¡ä¸å®ç°](https://labuladong.online/algo/problem-set/monotonic-queue/)

**è¯¦ç»†é¢˜è§£**ï¼š

- [ã€ç»ƒä¹ ã€‘å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°åŠç»å…¸ä¹ é¢˜](https://labuladong.online/algo/problem-set/monotonic-queue/)

### [è§£æ³•ä»£ç ](https://labuladong.online/algo/problem-set/monotonic-queue/#è§£æ³•ä»£ç -2)



```python
class Solution:
    def maxSubarraySumCircular(self, nums: List[int]) -> int:
        n = len(nums)
        # æ¨¡æ‹Ÿç¯çŠ¶çš„ nums æ•°ç»„
        preSum = [0] * (2 * n + 1)
        preSum[0] = 0
        # è®¡ç®—ç¯çŠ¶ nums çš„å‰ç¼€å’Œ
        for i in range(1, len(preSum)):
            preSum[i] = preSum[i - 1] + nums[(i - 1) % n]
        # è®°å½•ç­”æ¡ˆ
        maxSum = float('-inf')
        # ç»´æŠ¤ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œä»¥ä¾¿æ ¹æ®çª—å£ä¸­çš„æœ€å°å€¼è®¡ç®—æœ€å¤§å­æ•°ç»„å’Œ
        window = MonotonicQueue()
        window.push(0)
        for i in range(1, len(preSum)):
            maxSum = max(maxSum, preSum[i] - window.min())
            # ç»´æŠ¤çª—å£çš„å¤§å°ä¸º nums æ•°ç»„çš„å¤§å°
            if window.size() == n:
                window.pop()
            window.push(preSum[i])
        return maxSum

# ä¸‹é¢ç»™å‡ºçš„æ˜¯å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°ï¼Œè¿è¡Œé€Ÿåº¦å¯èƒ½è¾ƒæ…¢ï¼Œä½ å¯ä»¥è‡ªè¡Œç®€åŒ–æå‡é€Ÿåº¦
# å•è°ƒé˜Ÿåˆ—çš„è¯¦ç»†è§£æè§
# https://labuladong.online/algo/problem-set/monotonic-queue/
class MonotonicQueue:
    # å¸¸è§„é˜Ÿåˆ—ï¼Œå­˜å‚¨æ‰€æœ‰å…ƒç´ 
    def __init__(self):
        self.q = collections.deque()
        # å…ƒç´ é™åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å¤§å€¼
        self.maxq = collections.deque()
        # å…ƒç´ å‡åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å°å€¼
        self.minq = collections.deque()

    def push(self, elem):
        # ç»´æŠ¤å¸¸è§„é˜Ÿåˆ—ï¼Œç›´æ¥åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ 
        self.q.append(elem)

        # ç»´æŠ¤ maxqï¼Œå°†å°äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.maxq and self.maxq[-1] < elem:
            self.maxq.pop()
        self.maxq.append(elem)

        # ç»´æŠ¤ minqï¼Œå°†å¤§äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.minq and self.minq[-1] > elem:
            self.minq.pop()
        self.minq.append(elem)

    def max(self):
        # maxq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.maxq[0]

    def min(self):
        # minq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.minq[0]

    def pop(self):
        # ä»æ ‡å‡†é˜Ÿåˆ—å¤´éƒ¨å¼¹å‡ºéœ€è¦åˆ é™¤çš„å…ƒç´ 
        deleteVal = self.q.popleft()

        # ç”±äº push çš„æ—¶å€™ä¼šåˆ é™¤å…ƒç´ ï¼ŒdeleteVal å¯èƒ½å·²ç»è¢«åˆ æ‰äº†
        if deleteVal == self.maxq[0]:
            self.maxq.popleft()
        if deleteVal == self.minq[0]:
            self.minq.popleft()
        return deleteVal

    def size(self):
        # æ ‡å‡†é˜Ÿåˆ—çš„å¤§å°å³æ˜¯å½“å‰é˜Ÿåˆ—çš„å¤§å°
        return len(self.q)

    def isEmpty(self):
        return not self.q
```

### [å¯è§†åŒ–](https://labuladong.online/algo/problem-set/monotonic-queue/#å¯è§†åŒ–-1)

<details data-v-ee1a9bd0="" id="div_maximum-sum-circular-subarray" class="hint-container details" style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.1); transition: background 0.3s ease 0s, color 0.3s ease 0s; display: block; margin-block: 0.75rem; padding: 1rem 0px 0px; border-radius: 0.5rem; margin: 1.3em 0px;"><summary data-v-ee1a9bd0="" style="position: relative; margin: -1rem 0px 0px; padding-block: 1em; padding-inline: 2.3em 1.5em; list-style: none; font-size: large; cursor: pointer; display: flex; align-items: center;"><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path data-v-ee1a9bd0="" fill="currentColor" d="m4.415 18.167l7.17-7.17l1.414 1.414l-7.17 7.17z" opacity="0.3"></path><path data-v-ee1a9bd0="" fill="currentColor" d="m20 7l.94-2.06L23 4l-2.06-.94L20 1l-.94 2.06L17 4l2.06.94zM8.5 7l.94-2.06L11.5 4l-2.06-.94L8.5 1l-.94 2.06L5.5 4l2.06.94zM20 12.5l-.94 2.06l-2.06.94l2.06.94l.94 2.06l.94-2.06L23 15.5l-2.06-.94zm-2.29-3.38l-2.83-2.83c-.2-.19-.45-.29-.71-.29s-.51.1-.71.29L2.29 17.46a.996.996 0 0 0 0 1.41l2.83 2.83c.2.2.45.3.71.3s.51-.1.71-.29l11.17-11.17c.39-.39.39-1.03 0-1.42M5.83 19.59l-1.41-1.41L11.59 11L13 12.41zM14.41 11L13 9.59l1.17-1.17l1.41 1.41z"></path></svg>&nbsp;<strong data-v-ee1a9bd0="" style="font-weight: 600;">ç®—æ³•å¯è§†åŒ–é¢æ¿</strong><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="0.9em" height="0.9em" viewBox="0 0 24 24" style="margin-left: auto; margin-right: 10px;"><path data-v-ee1a9bd0="" fill="currentColor" d="M20 20v1h1v-1zm-4.293-5.707a1 1 0 0 0-1.414 1.414zM19 14v6h2v-6zm1 5h-6v2h6zm.707.293l-5-5l-1.414 1.414l5 5zM4 20H3v1h1zm5.707-4.293a1 1 0 0 0-1.414-1.414zM3 14v6h2v-6zm1 7h6v-2H4zm.707-.293l5-5l-1.414-1.414l-5 5zM20 4h1V3h-1zm-5.707 4.293a1 1 0 0 0 1.414 1.414zM21 10V4h-2v6zm-1-7h-6v2h6zm-.707.293l-5 5l1.414 1.414l5-5zM4 4V3H3v1zm4.293 5.707a1 1 0 0 0 1.414-1.414zM5 10V4H3v6zM4 5h6V3H4zm-.707-.293l5 5l1.414-1.414l-5-5z"></path></svg><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" style="margin-right: 10px;"><path data-v-ee1a9bd0="" fill="currentColor" d="M17.65 6.35a7.95 7.95 0 0 0-6.48-2.31c-3.67.37-6.69 3.35-7.1 7.02C3.52 15.91 7.27 20 12 20a7.98 7.98 0 0 0 7.21-4.56c.32-.67-.16-1.44-.9-1.44c-.37 0-.72.2-.88.53a5.994 5.994 0 0 1-6.8 3.31c-2.22-.49-4.01-2.3-4.48-4.52A6.002 6.002 0 0 1 12 6c1.66 0 3.14.69 4.22 1.78l-1.51 1.51c-.63.63-.19 1.71.7 1.71H19c.55 0 1-.45 1-1V6.41c0-.89-1.08-1.34-1.71-.71z"></path></svg><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path data-v-ee1a9bd0="" fill="currentColor" d="M17 7h-4v2h4c1.65 0 3 1.35 3 3s-1.35 3-3 3h-4v2h4c2.76 0 5-2.24 5-5s-2.24-5-5-5m-6 8H7c-1.65 0-3-1.35-3-3s1.35-3 3-3h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4zm-3-4h8v2H8z"></path></svg></summary><div data-v-ee1a9bd0="" class="resizable" style="width: 780px; max-width: 100%; height: 70vh; min-height: 500px; overflow: hidden; resize: both;"><iframe data-v-ee1a9bd0="" title="algo-visualize panel" allow="clipboard-write; fullscreen;" id="iframe_maximum-sum-circular-subarray" src="https://labuladong.online/algo-visualize/leetcode/maximum-sum-circular-subarray/" width="100%" height="100%" loading="lazy" scrolling="auto" frameborder="0" style="overflow: auto;"></iframe></div></details>

------

## [å•è°ƒé˜Ÿåˆ— + åŠ¨æ€è§„åˆ’ï¼ˆé€‰å­¦ï¼‰](https://labuladong.online/algo/problem-set/monotonic-queue/#å•è°ƒé˜Ÿåˆ—-åŠ¨æ€è§„åˆ’-é€‰å­¦)

åŠ¨æ€è§„åˆ’å¾ˆå¤šæ—¶å€™ä¼šç”¨åˆ°åµŒå¥— for å¾ªç¯è®¡ç®—æœ€å€¼ï¼Œå¦‚æœæ˜¯è®¡ç®—ä¸€ä¸ªçª—å£ä¸­çš„æœ€å€¼ï¼Œå¯ä»¥åˆ©ç”¨å•è°ƒé˜Ÿåˆ—ç»“æ„ç»´æŠ¤æœ€å€¼ï¼Œä»è€Œæ¶ˆé™¤ä¸€å±‚ for å¾ªç¯ï¼Œé™ä½æ—¶é—´å¤æ‚åº¦ã€‚

------

## [1696. è·³è·ƒæ¸¸æˆ VI](https://labuladong.online/algo/problem-set/monotonic-queue/#slug_jump-game-vi)

<details class="hint-container details" open="" style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.1); transition: background 0.3s ease 0s, color 0.3s ease 0s; display: block; margin-block: 0.75rem; padding: 1.25rem 1rem; border-radius: 0.5rem; color: rgb(60, 60, 67); font-family: Inter, ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="position: relative; margin: -1rem -1rem 0.5em; padding-block: 1em; padding-inline: 3em 1.5em; list-style: none; font-size: 16px; cursor: pointer;"><strong style="font-weight: 600;">1696. è·³è·ƒæ¸¸æˆ VI</strong>&nbsp;|<span>&nbsp;</span><span><a href="https://leetcode.cn/problems/jump-game-vi/" class="" target="_blank" rel="noopener noreferrer" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">åŠ›æ‰£</a><span>&nbsp;</span>|<span>&nbsp;</span></span><span><a href="https://leetcode.com/problems/jump-game-vi/" class="" target="_blank" rel="noopener noreferrer" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">LeetCode</a><span>&nbsp;</span>|</span><span>&nbsp;</span>&nbsp;ğŸŸ </summary><div><p style="line-height: 1.6; overflow-wrap: break-word;">ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä»<span>&nbsp;</span><strong style="font-weight: 600;">0</strong><span>&nbsp;</span>å¼€å§‹çš„æ•´æ•°æ•°ç»„<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums</code><span>&nbsp;</span>å’Œä¸€ä¸ªæ•´æ•°<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">k</code><span>&nbsp;</span>ã€‚</p><p style="line-height: 1.6; overflow-wrap: break-word;">ä¸€å¼€å§‹ä½ åœ¨ä¸‹æ ‡<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">0</code><span>&nbsp;</span>å¤„ã€‚æ¯ä¸€æ­¥ï¼Œä½ æœ€å¤šå¯ä»¥å¾€å‰è·³<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">k</code><span>&nbsp;</span>æ­¥ï¼Œä½†ä½ ä¸èƒ½è·³å‡ºæ•°ç»„çš„è¾¹ç•Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥ä»ä¸‹æ ‡<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">i</code><span>&nbsp;</span>è·³åˆ°<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">[i + 1ï¼Œ min(n - 1, i + k)]</code><span>&nbsp;</span><strong style="font-weight: 600;">åŒ…å«</strong><span>&nbsp;</span>ä¸¤ä¸ªç«¯ç‚¹çš„ä»»æ„ä½ç½®ã€‚</p><p style="line-height: 1.6; overflow-wrap: break-word;">ä½ çš„ç›®æ ‡æ˜¯åˆ°è¾¾æ•°ç»„æœ€åä¸€ä¸ªä½ç½®ï¼ˆä¸‹æ ‡ä¸º<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">n - 1</code><span>&nbsp;</span>ï¼‰ï¼Œä½ çš„<span>&nbsp;</span><strong style="font-weight: 600;">å¾—åˆ†</strong><span>&nbsp;</span>ä¸ºç»è¿‡çš„æ‰€æœ‰æ•°å­—ä¹‹å’Œã€‚</p><p style="line-height: 1.6; overflow-wrap: break-word;">è¯·ä½ è¿”å›ä½ èƒ½å¾—åˆ°çš„<span>&nbsp;</span><strong style="font-weight: 600;">æœ€å¤§å¾—åˆ†</strong><span>&nbsp;</span>ã€‚</p><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 1ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><b>è¾“å…¥ï¼š</b>nums = [<strong style="font-weight: 600;">1</strong>,<strong style="font-weight: 600;">-1</strong>,-2,<strong style="font-weight: 600;">4</strong>,-7,<strong style="font-weight: 600;">3</strong>], k = 2
<b>è¾“å‡ºï¼š</b>7
<b>è§£é‡Šï¼š</b>ä½ å¯ä»¥é€‰æ‹©å­åºåˆ— [1,-1,4,3] ï¼ˆä¸Šé¢åŠ ç²—çš„æ•°å­—ï¼‰ï¼Œå’Œä¸º 7 ã€‚
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 2ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [<strong style="font-weight: 600;">10</strong>,-5,-2,<strong style="font-weight: 600;">4</strong>,0,<strong style="font-weight: 600;">3</strong>], k = 3
<b>è¾“å‡ºï¼š</b>17
<b>è§£é‡Šï¼š</b>ä½ å¯ä»¥é€‰æ‹©å­åºåˆ— [10,4,3] ï¼ˆä¸Šé¢åŠ ç²—æ•°å­—ï¼‰ï¼Œå’Œä¸º 17 ã€‚
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 3ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><b>è¾“å…¥ï¼š</b>nums = [1,-5,-20,4,-1,3,-6,-3], k = 2
<b>è¾“å‡ºï¼š</b>0
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">æç¤ºï¼š</strong></p><ul style="line-height: 1.6; overflow-wrap: break-word; padding-inline-start: 1.2em;"><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">1 &lt;= nums.length, k &lt;= 10<sup>5</sup></code></li><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">-10<sup>4</sup><span>&nbsp;</span>&lt;= nums[i] &lt;= 10<sup>4</sup></code></li></ul></div><strong style="font-weight: 600; font-size: small;">é¢˜ç›®æ¥æºï¼š<a href="https://leetcode.cn/problems/jump-game-vi/" class="" target="_blank" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">åŠ›æ‰£ 1696. è·³è·ƒæ¸¸æˆ VI</a>ã€‚</strong></details>

### [åŸºæœ¬æ€è·¯](https://labuladong.online/algo/problem-set/monotonic-queue/#åŸºæœ¬æ€è·¯-3)

è¿™é¢˜å’Œ [1425. å¸¦é™åˆ¶çš„å­åºåˆ—å’Œ](https://leetcode.cn/problems/constrained-subsequence-sum) éå¸¸åƒï¼š

1425 é¢˜æ˜¯è®©ä½ æ±‚æœ€å¤§å­åºåˆ—å’Œï¼Œå­åºåˆ—ä¸­æ¯ä¸¤ä¸ªå…ƒç´ ä¹‹é—´çš„é—´éš”ä¸èƒ½è¶…è¿‡ `k`ï¼›è¿™é“é¢˜å…¶å®ä¹Ÿæ˜¯è®©ä½ æ±‚å…ƒç´ é—´éš”ä¸è¶…è¿‡ `k` çš„æœ€å¤§å­åºåˆ—å’Œï¼Œåªä¸è¿‡åˆå¤šäº†äº›é™åˆ¶ï¼Œå³å­åºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¿…é¡»æ˜¯ `nums[0]`ï¼Œæœ€åä¸€ä¸ªå…ƒç´ å¿…é¡»æ˜¯ `nums[-1]`ã€‚

ä½ å¯ä»¥æƒ³åŠæ³•å¤ç”¨ç¬¬ 1425 é¢˜çš„è§£æ³•ï¼Œä¸è¿‡æˆ‘è¿™é‡ŒæŒ‰ç…§æ ‡å‡†çš„ [åŠ¨æ€è§„åˆ’è§£é¢˜æ¡†æ¶](https://labuladong.online/algo/essential-technique/dynamic-programming-framework/) æ¥é€æ­¥ä¼˜åŒ–ï¼Œæœ€åé€šè¿‡ [å•è°ƒé˜Ÿåˆ—ç»“æ„](https://labuladong.online/algo/data-structure/monotonic-queue/) ä¸­ç»™å‡ºçš„å•è°ƒé˜Ÿåˆ—é€šç”¨å®ç°æ¥ä¼˜åŒ–åŠ¨æ€è§„åˆ’è§£æ³•çš„æ•ˆç‡ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬é¢˜ä½¿ç”¨æ ‡å‡†çš„åŠ¨æ€è§„åˆ’è§£æ³•ä¹Ÿä¼šè¶…æ—¶ï¼Œè¿™å¹¶ä¸æ˜¯åŠ¨æ€è§„åˆ’çš„é”…ï¼Œè€Œæ˜¯æœ¬é¢˜ç»™çš„æ•°æ®è§„æ¨¡å¤ªå¤§ï¼Œéœ€è¦æ›´å…ˆè¿›çš„æ•°æ®ç»“æ„ï¼ˆå•è°ƒé˜Ÿåˆ—ï¼‰æ¥ä¼˜åŒ–çŠ¶æ€è½¬ç§»çš„æ•ˆç‡ã€‚

> PSï¼š`MonotonicQueue` çš„é€šç”¨å®ç°è§ [å•è°ƒé˜Ÿåˆ—è®¾è®¡ä¸å®ç°](https://labuladong.online/algo/problem-set/monotonic-queue/)

**è¯¦ç»†é¢˜è§£**ï¼š

- [ã€ç»ƒä¹ ã€‘å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°åŠç»å…¸ä¹ é¢˜](https://labuladong.online/algo/problem-set/monotonic-queue/)

### [è§£æ³•ä»£ç ](https://labuladong.online/algo/problem-set/monotonic-queue/#è§£æ³•ä»£ç -3)



```python
# ç¬¬ä¸€æ­¥ï¼Œæš´åŠ›é€’å½’è§£æ³•ï¼ˆè¶…æ—¶ï¼‰
class Solution1:
    def maxResult(self, nums: List[int], k: int) -> int:
        n = len(nums)
        return self.dp(nums, n - 1, k)

    # å®šä¹‰ï¼šåˆ°è¾¾ nums[p] æ‰€èƒ½è·å¾—çš„æœ€å¤§åˆ†æ•°æ˜¯ dp(nums, p)
    # èƒ½è·³åˆ° nums[p]ï¼Œå¿…ç„¶æ˜¯ä» nums[p-k..p-1] ä¸­çš„æŸä¸ªä½ç½®è·³æ¥çš„
    # æ•…çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼šdp[p] = max(nums[p-k..p-1]) + nums[p]
    def dp(self, nums: List[int], p: int, k: int) -> int:
        if p == 0:
            return nums[0]
        if p < 0:
            return float('-inf')
        # å®ç°çŠ¶æ€è½¬ç§»æ–¹ç¨‹
        res = float('-inf')
        for i in range(1, k + 1):
            res = max(res, self.dp(nums, p - i, k))
        res += nums[p]
        return res

# ç¬¬äºŒæ­¥ï¼Œå¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•ï¼ˆè¶…æ—¶ï¼‰
class Solution2:
    # å¤‡å¿˜å½•
    def __init__(self):
        self.memo = []

    def maxResult(self, nums: List[int], k: int) -> int:
        n = len(nums)
        self.memo = [float('-inf')] * n
        # å¤‡å¿˜å½•åˆå§‹åŒ–ä¸ºæœ€å°å€¼
        return self.dp(nums, n - 1, k)

    # å®šä¹‰ï¼šåˆ°è¾¾ nums[p] æ‰€èƒ½è·å¾—çš„æœ€å¤§åˆ†æ•°æ˜¯ dp(nums, p)
    def dp(self, nums: List[int], p: int, k: int) -> int:
        if p == 0:
            return nums[0]
        if p < 0:
            return float('-inf')
        # æŸ¥å¤‡å¿˜å½•ï¼Œé¿å…å†—ä½™è®¡ç®—
        if self.memo[p] != float('-inf'):
            return self.memo[p]
        # å®ç°çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œç»“æœå­˜å…¥å¤‡å¿˜å½•
        for i in range(1, k + 1):
            self.memo[p] = max(self.memo[p], self.dp(nums, p - i, k))
        self.memo[p] += nums[p]
        return self.memo[p]

# ç¬¬ä¸‰æ­¥ï¼Œè‡ªé¡¶å‘ä¸‹çš„é€’å½’æ”¹ä¸ºè‡ªåº•å‘ä¸Šçš„è¿­ä»£è§£æ³•ï¼ˆè¶…æ—¶ï¼‰
class Solution3:
    def maxResult(self, nums: List[int], k: int) -> int:
        n = len(nums)
        # å®šä¹‰ï¼šåˆ°è¾¾ nums[p] çš„æœ€å¤§åˆ†æ•°ä¸º dp[p]
        dp = [float('-inf')] * n
        # dp æ•°ç»„åˆå§‹åŒ–ä¸ºæœ€å°å€¼
        dp[0] = nums[0]
        # çŠ¶æ€è½¬ç§»
        for p in range(1, n):
            for i in range(1, k + 1):
                if p - i < 0:
                    continue
                dp[p] = max(dp[p], dp[p - i])
            dp[p] += nums[p]
        return dp[n - 1]

# ç¬¬å››æ­¥ï¼Œåˆ©ç”¨å•è°ƒé˜Ÿåˆ—ç»“æ„æ¶ˆé™¤å†…å±‚å¾ªç¯ï¼ˆé€šè¿‡ï¼‰
class Solution:
    def maxResult(self, nums: List[int], k: int) -> int:
        n = len(nums)
        window = MonotonicQueue()
        # å®šä¹‰ï¼šåˆ°è¾¾ nums[p] çš„æœ€å¤§åˆ†æ•°ä¸º dp[p]
        dp = [float('-inf')] * n
        # dp æ•°ç»„åˆå§‹åŒ–ä¸ºæœ€å°å€¼
        dp[0] = nums[0]
        window.push(dp[0])
        # çŠ¶æ€è½¬ç§»
        for p in range(1, n):
            dp[p] = window.max() + nums[p]
            # ç»´æŠ¤çª—å£è£…ç€ dp[p-1..p-k]
            if window.size() == k:
                window.pop()
            window.push(dp[p])
        return dp[n - 1]

# ä¸‹é¢ç»™å‡ºçš„æ˜¯å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°ï¼Œè¿è¡Œé€Ÿåº¦å¯èƒ½è¾ƒæ…¢ï¼Œä½ å¯ä»¥è‡ªè¡Œç®€åŒ–æå‡é€Ÿåº¦
# å•è°ƒé˜Ÿåˆ—çš„è¯¦ç»†è§£æè§
# https://labuladong.online/algo/problem-set/monotonic-queue/
class MonotonicQueue:
    # å¸¸è§„é˜Ÿåˆ—ï¼Œå­˜å‚¨æ‰€æœ‰å…ƒç´ 
    def __init__(self):
        self.q = collections.deque()
        # å…ƒç´ é™åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å¤§å€¼
        self.maxq = collections.deque()
        # å…ƒç´ å‡åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å°å€¼
        self.minq = collections.deque()

    def push(self, elem: int):
        # ç»´æŠ¤å¸¸è§„é˜Ÿåˆ—ï¼Œç›´æ¥åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ 
        self.q.append(elem)

        # ç»´æŠ¤ maxqï¼Œå°†å°äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.maxq and self.maxq[-1] < elem:
            self.maxq.pop()
        self.maxq.append(elem)

        # ç»´æŠ¤ minqï¼Œå°†å¤§äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.minq and self.minq[-1] > elem:
            self.minq.pop()
        self.minq.append(elem)

    def max(self) -> int:
        # maxq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.maxq[0]

    def min(self) -> int:
        # minq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.minq[0]

    def pop(self):
        # ä»æ ‡å‡†é˜Ÿåˆ—å¤´éƒ¨å¼¹å‡ºéœ€è¦åˆ é™¤çš„å…ƒç´ 
        deleteVal = self.q.popleft()

        # ç”±äº push çš„æ—¶å€™ä¼šåˆ é™¤å…ƒç´ ï¼ŒdeleteVal å¯èƒ½å·²ç»è¢«åˆ æ‰äº†
        if deleteVal == self.maxq[0]:
            self.maxq.popleft()
        if deleteVal == self.minq[0]:
            self.minq.popleft()

    def size(self) -> int:
        # æ ‡å‡†é˜Ÿåˆ—çš„å¤§å°å³æ˜¯å½“å‰é˜Ÿåˆ—çš„å¤§å°
        return len(self.q)

    def isEmpty(self) -> bool:
        return not self.q
```

### [å¯è§†åŒ–](https://labuladong.online/algo/problem-set/monotonic-queue/#å¯è§†åŒ–-2)

<details data-v-ee1a9bd0="" id="div_jump-game-vi" class="hint-container details" style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.1); transition: background 0.3s ease 0s, color 0.3s ease 0s; display: block; margin-block: 0.75rem; padding: 1rem 0px 0px; border-radius: 0.5rem; margin: 1.3em 0px;"><summary data-v-ee1a9bd0="" style="position: relative; margin: -1rem 0px 0px; padding-block: 1em; padding-inline: 2.3em 1.5em; list-style: none; font-size: large; cursor: pointer; display: flex; align-items: center;"><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path data-v-ee1a9bd0="" fill="currentColor" d="m4.415 18.167l7.17-7.17l1.414 1.414l-7.17 7.17z" opacity="0.3"></path><path data-v-ee1a9bd0="" fill="currentColor" d="m20 7l.94-2.06L23 4l-2.06-.94L20 1l-.94 2.06L17 4l2.06.94zM8.5 7l.94-2.06L11.5 4l-2.06-.94L8.5 1l-.94 2.06L5.5 4l2.06.94zM20 12.5l-.94 2.06l-2.06.94l2.06.94l.94 2.06l.94-2.06L23 15.5l-2.06-.94zm-2.29-3.38l-2.83-2.83c-.2-.19-.45-.29-.71-.29s-.51.1-.71.29L2.29 17.46a.996.996 0 0 0 0 1.41l2.83 2.83c.2.2.45.3.71.3s.51-.1.71-.29l11.17-11.17c.39-.39.39-1.03 0-1.42M5.83 19.59l-1.41-1.41L11.59 11L13 12.41zM14.41 11L13 9.59l1.17-1.17l1.41 1.41z"></path></svg>&nbsp;<strong data-v-ee1a9bd0="" style="font-weight: 600;">ç®—æ³•å¯è§†åŒ–é¢æ¿</strong><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="0.9em" height="0.9em" viewBox="0 0 24 24" style="margin-left: auto; margin-right: 10px;"><path data-v-ee1a9bd0="" fill="currentColor" d="M20 20v1h1v-1zm-4.293-5.707a1 1 0 0 0-1.414 1.414zM19 14v6h2v-6zm1 5h-6v2h6zm.707.293l-5-5l-1.414 1.414l5 5zM4 20H3v1h1zm5.707-4.293a1 1 0 0 0-1.414-1.414zM3 14v6h2v-6zm1 7h6v-2H4zm.707-.293l5-5l-1.414-1.414l-5 5zM20 4h1V3h-1zm-5.707 4.293a1 1 0 0 0 1.414 1.414zM21 10V4h-2v6zm-1-7h-6v2h6zm-.707.293l-5 5l1.414 1.414l5-5zM4 4V3H3v1zm4.293 5.707a1 1 0 0 0 1.414-1.414zM5 10V4H3v6zM4 5h6V3H4zm-.707-.293l5 5l1.414-1.414l-5-5z"></path></svg><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" style="margin-right: 10px;"><path data-v-ee1a9bd0="" fill="currentColor" d="M17.65 6.35a7.95 7.95 0 0 0-6.48-2.31c-3.67.37-6.69 3.35-7.1 7.02C3.52 15.91 7.27 20 12 20a7.98 7.98 0 0 0 7.21-4.56c.32-.67-.16-1.44-.9-1.44c-.37 0-.72.2-.88.53a5.994 5.994 0 0 1-6.8 3.31c-2.22-.49-4.01-2.3-4.48-4.52A6.002 6.002 0 0 1 12 6c1.66 0 3.14.69 4.22 1.78l-1.51 1.51c-.63.63-.19 1.71.7 1.71H19c.55 0 1-.45 1-1V6.41c0-.89-1.08-1.34-1.71-.71z"></path></svg><svg data-v-ee1a9bd0="" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path data-v-ee1a9bd0="" fill="currentColor" d="M17 7h-4v2h4c1.65 0 3 1.35 3 3s-1.35 3-3 3h-4v2h4c2.76 0 5-2.24 5-5s-2.24-5-5-5m-6 8H7c-1.65 0-3-1.35-3-3s1.35-3 3-3h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4zm-3-4h8v2H8z"></path></svg></summary><div data-v-ee1a9bd0="" class="resizable" style="width: 780px; max-width: 100%; height: 70vh; min-height: 500px; overflow: hidden; resize: both;"><iframe data-v-ee1a9bd0="" title="algo-visualize panel" allow="clipboard-write; fullscreen;" id="iframe_jump-game-vi" src="https://labuladong.online/algo-visualize/leetcode/jump-game-vi/" width="100%" height="100%" loading="lazy" scrolling="auto" frameborder="0" style="overflow: auto;"></iframe></div></details>

## [1425. å¸¦é™åˆ¶çš„å­åºåˆ—å’Œ](https://labuladong.online/algo/problem-set/monotonic-queue/#slug_constrained-subsequence-sum)

<details class="hint-container details" open="" style="background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.1); transition: background 0.3s ease 0s, color 0.3s ease 0s; display: block; margin-block: 0.75rem; padding: 1.25rem 1rem; border-radius: 0.5rem; color: rgb(60, 60, 67); font-family: Inter, ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="position: relative; margin: -1rem -1rem 0.5em; padding-block: 1em; padding-inline: 3em 1.5em; list-style: none; font-size: 16px; cursor: pointer;"><strong style="font-weight: 600;">1425. å¸¦é™åˆ¶çš„å­åºåˆ—å’Œ</strong>&nbsp;|<span>&nbsp;</span><span><a href="https://leetcode.cn/problems/constrained-subsequence-sum/" class="" target="_blank" rel="noopener noreferrer" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">åŠ›æ‰£</a><span>&nbsp;</span>|<span>&nbsp;</span></span><span><a href="https://leetcode.com/problems/constrained-subsequence-sum/" class="" target="_blank" rel="noopener noreferrer" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">LeetCode</a><span>&nbsp;</span>|</span><span>&nbsp;</span>&nbsp;ğŸ”´</summary><div><p style="line-height: 1.6; overflow-wrap: break-word;">ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums</code>&nbsp;å’Œä¸€ä¸ªæ•´æ•°&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">k</code>&nbsp;ï¼Œè¯·ä½ è¿”å›<span>&nbsp;</span><strong style="font-weight: 600;">éç©º</strong>&nbsp;å­åºåˆ—å…ƒç´ å’Œçš„æœ€å¤§å€¼ï¼Œå­åºåˆ—éœ€è¦æ»¡è¶³ï¼šå­åºåˆ—ä¸­æ¯ä¸¤ä¸ª<span>&nbsp;</span><strong style="font-weight: 600;">ç›¸é‚»</strong>&nbsp;çš„æ•´æ•°&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums[i]</code>&nbsp;å’Œ&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">nums[j]</code>&nbsp;ï¼Œå®ƒä»¬åœ¨åŸæ•°ç»„ä¸­çš„ä¸‹æ ‡&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">i</code>&nbsp;å’Œ&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">j</code>&nbsp;æ»¡è¶³&nbsp;<code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">i &lt; j</code>&nbsp;ä¸”<span>&nbsp;</span><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">j - i &lt;= k</code><span>&nbsp;</span>ã€‚</p><p style="line-height: 1.6; overflow-wrap: break-word;">æ•°ç»„çš„å­åºåˆ—å®šä¹‰ä¸ºï¼šå°†æ•°ç»„ä¸­çš„è‹¥å¹²ä¸ªæ•°å­—åˆ é™¤ï¼ˆå¯ä»¥åˆ é™¤ 0 ä¸ªæ•°å­—ï¼‰ï¼Œå‰©ä¸‹çš„æ•°å­—æŒ‰ç…§åŸæœ¬çš„é¡ºåºæ’å¸ƒã€‚</p><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 1ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [10,2,-10,5,20], k = 2
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>37
<strong style="font-weight: 600;">è§£é‡Šï¼š</strong>å­åºåˆ—ä¸º [10, 2, 5, 20] ã€‚
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 2ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [-1,-2,-3], k = 1
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>-1
<strong style="font-weight: 600;">è§£é‡Šï¼š</strong>å­åºåˆ—å¿…é¡»æ˜¯éç©ºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©æœ€å¤§çš„æ•°å­—ã€‚
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">ç¤ºä¾‹ 3ï¼š</strong></p><pre style="text-align: left; direction: ltr; white-space: pre; word-spacing: normal; word-break: normal; overflow-wrap: unset; tab-size: 4; hyphens: none; overflow: auto;"><strong style="font-weight: 600;">è¾“å…¥ï¼š</strong>nums = [10,-2,-10,-5,20], k = 2
<strong style="font-weight: 600;">è¾“å‡ºï¼š</strong>23
<strong style="font-weight: 600;">è§£é‡Šï¼š</strong>å­åºåˆ—ä¸º [10, -2, -5, 20] ã€‚
</pre><p style="line-height: 1.6; overflow-wrap: break-word;"><strong style="font-weight: 600;">æç¤ºï¼š</strong></p><ul style="line-height: 1.6; overflow-wrap: break-word; padding-inline-start: 1.2em;"><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">1 &lt;= k &lt;= nums.length &lt;= 10^5</code></li><li><code style="font-family: ui-monospace, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin: 0px; padding: 3px 6px; border-radius: 4px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(142, 150, 170, 0.14); font-size: 0.875em; overflow-wrap: break-word; transition: background-color 0.3s, color 0.3s;">-10^4&nbsp;&lt;= nums[i] &lt;= 10^4</code></li></ul></div><strong style="font-weight: 600; font-size: small;">é¢˜ç›®æ¥æºï¼š<a href="https://leetcode.cn/problems/constrained-subsequence-sum/" class="" target="_blank" style="color: rgb(7, 86, 171); font-weight: 500; text-decoration: none; overflow-wrap: break-word;">åŠ›æ‰£ 1425. å¸¦é™åˆ¶çš„å­åºåˆ—å’Œ</a>ã€‚</strong></details>

### [åŸºæœ¬æ€è·¯](https://labuladong.online/algo/problem-set/monotonic-queue/#åŸºæœ¬æ€è·¯-4)

å¦‚æœä½ çœ‹è¿‡åæ–‡ [æœ€é•¿é€’å¢å­åºåˆ—é—®é¢˜è¯¦è§£](https://labuladong.online/algo/dynamic-programming/longest-increasing-subsequence/)ï¼Œé‚£ä¹ˆè¿™é“é¢˜çš„æ€è·¯åº”è¯¥æ˜¯å¾ˆç®€å•çš„ï¼š

**è®¾è®¡ä¸€ä¸ª `dp` æ•°ç»„ï¼Œ`dp[i]` è¡¨ç¤ºä»¥ `nums[i]` ä¸ºç»“å°¾çš„æœ€å¤§å­åºåˆ—ä¹‹å’Œï¼Œç„¶åé¢˜ç›®è¦æ±‚çš„ç­”æ¡ˆå°±æ˜¯ `max(dp[..])`**ã€‚

ç”±äºé¢˜ç›®è¯´ä¸¤ä¸ªåºåˆ—ä¹‹é—´çš„é—´éš”ä¸èƒ½è¶…è¿‡ `k`ï¼Œæ‰€ä»¥ `dp[i]` çš„å€¼å°±å¯ä»¥æ ¹æ® `dp[i-k..i-1]` çš„å€¼æ¨å¯¼å‡ºæ¥ï¼Œé‚£ä¹ˆçŠ¶æ€è½¬ç§»é€»è¾‘å°±æ˜¯ï¼š

```java
for (int i = 1; i < n; i++) {
    int maxVal = 0;
    for (int j = 1; j <= k; j++) {
        maxVal = Math.max(maxVal, dp[i - j]);
    }
    dp[i] = maxVal + nums[i];
}
```

æƒ³åˆ°è¿™ä¸€æ­¥å…¶å®å·²ç»å¯ä»¥å†™å‡ºåŠ¨æ€è§„åˆ’è§£æ³•ä»£ç äº†ï¼Œä½†ç”±äºæµ‹è¯•æ•°æ®çš„è§„æ¨¡è¾ƒå¤§ï¼Œè¿™ä¸ª `O(KN)` çš„ç®—æ³•ä¼šè¶…æ—¶ã€‚

æˆ‘ä»¬æ³¨æ„åˆ°å†…å±‚çš„ for å¾ªç¯å®é™…ä¸Šå°±æ˜¯åœ¨è®¡ç®— `dp[i-k..i-1]` çš„æœ€å¤§å€¼ï¼Œéšç€ `i` çš„å¢åŠ ï¼Œ`dp[i-k..i-1]` å°±åƒä¸€ä¸ªæ»‘åŠ¨å‰è¿›çš„çª—å£ï¼Œè¿™ä¸ªåœºæ™¯ä¸éœ€è¦å‚»ä¹ä¹ç”¨ for å¾ªç¯éå†æ±‚æœ€å€¼ï¼Œå‰æ–‡è®²åˆ°çš„ [å•è°ƒé˜Ÿåˆ—](https://labuladong.online/algo/data-structure/monotonic-queue/) å¯ä»¥é«˜æ•ˆå®ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œå°†æ•´ä¸ªç®—æ³•çš„å¤æ‚åº¦é™ä½åˆ° `O(N)`ã€‚

æˆ‘å°†ç»™å‡ºç»è¿‡å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–çš„è§£æ³•ä»£ç å’Œæœªç»ä¼˜åŒ–çš„è§£æ³•ä»£ç ï¼Œæ³¨æ„å•è°ƒé˜Ÿåˆ—åœ¨å…¶ä¸­èµ·åˆ°çš„ä½œç”¨ã€‚

> PSï¼š`MonotonicQueue` çš„é€šç”¨å®ç°è§ [å•è°ƒé˜Ÿåˆ—è®¾è®¡ä¸å®ç°](https://labuladong.online/algo/problem-set/monotonic-queue/)

**è¯¦ç»†é¢˜è§£**ï¼š

- [ã€ç»ƒä¹ ã€‘å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°åŠç»å…¸ä¹ é¢˜](https://labuladong.online/algo/problem-set/monotonic-queue/)

### [è§£æ³•ä»£ç ](https://labuladong.online/algo/problem-set/monotonic-queue/#è§£æ³•ä»£ç -4)



```python
# ç»è¿‡å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–çš„åŠ¨æ€è§„åˆ’è§£æ³•
class Solution:
    def constrainedSubsetSum(self, nums: List[int], k: int) -> int:
        n = len(nums)
        # å®šä¹‰ï¼šdp[i] è¡¨ç¤ºä»¥ nums[i] ç»“å°¾çš„å­åºåˆ—çš„æœ€å¤§å’Œ
        dp = [0] * n
        dp[0] = nums[0]
        # å•è°ƒé˜Ÿåˆ—è¾…åŠ©è®¡ç®— dp[i-k..i-1] çš„æœ€å¤§å€¼
        window = MonotonicQueue()
        window.push(dp[0])

        for i in range(1, n):
            # çŠ¶æ€è½¬ç§»æ–¹ç¨‹
            dp[i] = max(nums[i], window.max() + nums[i])
            # ç»´æŠ¤æ»‘åŠ¨çª—å£çš„å¤§å°ä¸º k
            if window.size() == k:
                window.pop()
            window.push(dp[i])
        
        # dp æ•°ç»„ä¸­çš„æœ€å¤§å€¼å°±æ˜¯ç»“æœ
        res = float('-inf')
        for i in range(n):
            res = max(res, dp[i])
        return res

# ä¸‹é¢ç»™å‡ºçš„æ˜¯å•è°ƒé˜Ÿåˆ—çš„é€šç”¨å®ç°ï¼Œè¿è¡Œé€Ÿåº¦å¯èƒ½è¾ƒæ…¢ï¼Œä½ å¯ä»¥è‡ªè¡Œç®€åŒ–æå‡é€Ÿåº¦
# å•è°ƒé˜Ÿåˆ—çš„è¯¦ç»†è§£æè§
# https://labuladong.online/algo/problem-set/monotonic-queue/
class MonotonicQueue:
    # å¸¸è§„é˜Ÿåˆ—ï¼Œå­˜å‚¨æ‰€æœ‰å…ƒç´ 
    def __init__(self):
        self.q = collections.deque()
        # å…ƒç´ é™åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å¤§å€¼
        self.maxq = collections.deque()
        # å…ƒç´ å‡åºæ’åˆ—çš„å•è°ƒé˜Ÿåˆ—ï¼Œå¤´éƒ¨æ˜¯æœ€å°å€¼
        self.minq = collections.deque()

    def push(self, elem):
        # ç»´æŠ¤å¸¸è§„é˜Ÿåˆ—ï¼Œç›´æ¥åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ 
        self.q.append(elem)

        # ç»´æŠ¤ maxqï¼Œå°†å°äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.maxq and self.maxq[-1] < elem:
            self.maxq.pop()
        self.maxq.append(elem)

        # ç»´æŠ¤ minqï¼Œå°†å¤§äº elem çš„å…ƒç´ å…¨éƒ¨åˆ é™¤
        while self.minq and self.minq[-1] > elem:
            self.minq.pop()
        self.minq.append(elem)

    def max(self):
        # maxq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.maxq[0]

    def min(self):
        # minq çš„å¤´éƒ¨æ˜¯æœ€å¤§å…ƒç´ 
        return self.minq[0]

    def pop(self):
        # ä»æ ‡å‡†é˜Ÿåˆ—å¤´éƒ¨å¼¹å‡ºéœ€è¦åˆ é™¤çš„å…ƒç´ 
        deleteVal = self.q.popleft()

        # ç”±äº push çš„æ—¶å€™ä¼šåˆ é™¤å…ƒç´ ï¼ŒdeleteVal å¯èƒ½å·²ç»è¢«åˆ æ‰äº†
        if deleteVal == self.maxq[0]:
            self.maxq.popleft()
        if deleteVal == self.minq[0]:
            self.minq.popleft()
        return deleteVal

    def size(self):
        # æ ‡å‡†é˜Ÿåˆ—çš„å¤§å°å³æ˜¯å½“å‰é˜Ÿåˆ—çš„å¤§å°
        return len(self.q)

    def isEmpty(self):
        return not self.q

# æœªç»ä¼˜åŒ–çš„åŠ¨æ€è§„åˆ’è§£æ³•ï¼Œè¶…æ—¶
class Solution2:
    def constrainedSubsetSum(self, nums: List[int], k: int) -> int:
        n = len(nums)
        # å®šä¹‰ï¼šdp[i] è¡¨ç¤ºä»¥ nums[i] ç»“å°¾çš„å­åºåˆ—çš„æœ€å¤§å’Œ
        dp = [0] * n
        # base caseï¼Œä»¥ nums[0] ç»“å°¾çš„å­åºåˆ—åªæœ‰å®ƒæœ¬èº«
        dp[0] = nums[0]

        # çŠ¶æ€è½¬ç§»æ–¹ç¨‹
        for i in range(1, n):
            maxVal = 0
            for j in range(1, k+1):
                if i - j < 0:
                    continue
                maxVal = max(maxVal, dp[i - j])
            # dp[i] çš„å€¼å¯ä»¥æ ¹æ® dp[i-k..i-1] çš„æœ€å¤§å€¼æ¨å¯¼å‡ºæ¥
            dp[i] = maxVal + nums[i]

        # dp æ•°ç»„ä¸­çš„æœ€å¤§å€¼å°±æ˜¯ç»“æœ
        res = float('-inf')
        for i in range(n):
            res = max(res, dp[i])
        return res
```
